package com.project1.invoiceInfo.controller;

import com.project1.invoiceInfo.entity.InvoiceInfo;
import com.project1.invoiceInfo.entity.Product;
import com.project1.invoiceInfo.service.InvoiceInfoService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.support.PagedListHolder;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import java.util.ArrayList;
import java.util.List;

@Controller
public class InvoiceInfoController {
    @Autowired
    private InvoiceInfoService invoiceInfoService;

    @GetMapping("/")
    public String InvoiceInfoListPage(Model model) {
        model.addAttribute("InvoiceInfoList", invoiceInfoService.getAllInvoiceInfo());
        model.addAttribute("products",invoiceInfoService.getAllProducts());
        return "Home";
    	
    }

    @GetMapping("/openNewInvoiceInfoForm")
    public String openNewInvoiceInfoForm(Model model) {
        InvoiceInfo invoiceInfo = new InvoiceInfo();
        model.addAttribute("invoiceInfo", invoiceInfo);
        return "new_invoiceInfo";
    }


    @PostMapping("/saveInvoice")
    public String saveInvoiceInfo(@ModelAttribute("invoiceInfo") InvoiceInfo invoiceInfo) {

//        System.out.println(invoiceInfo);
        
        invoiceInfoService.saveInvoiceInfo(invoiceInfo);
        return "redirect:/showInvoice";
    }

    @GetMapping("/editInvoiceForm/{id}")
    public String editInvoiceForm(@PathVariable(value = "id") long id , Model model) {
        InvoiceInfo invoiceInfo= invoiceInfoService.getInvoiceById(id);
        model.addAttribute("invoiceInfo",invoiceInfo);
        return "update_invoiceInfo";
    }
    @GetMapping("/deleteInvoiceByid/{id}")
    public String deleteInvoiceByid(@PathVariable(value = "id") long id){
            this.invoiceInfoService.deleteInvoiceById(id);
            return "redirect:/";
    }
    
    @GetMapping("/showInvoice")
    public String showInvoiceInfo(Model model , Pageable pageable) {
    	 Page<InvoiceInfo> pages=invoiceInfoService.getPage(pageable);
    	 model.addAttribute("number", pages.getNumber());
    	 model.addAttribute("totalPages", pages.getTotalPages());
    	 model.addAttribute("totalElements", pages.getTotalElements());
    	 model.addAttribute("size", pages.getSize());
    	 model.addAttribute("data",pages.getContent());
         return "Home";
    }
  
}
